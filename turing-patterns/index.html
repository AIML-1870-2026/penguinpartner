<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turing Patterns Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            background: #0f0f0f;
            color: #e0e0e0;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .panel { background: #1a1a1a; border-radius: 12px; }
        .panel-section { border-bottom: 1px solid #2a2a2a; }
        .btn {
            transition: all 0.2s ease;
            background: #2a2a2a;
        }
        .btn:hover { background: #3a3a3a; }
        .btn.active { background: #4f46e5; color: white; }
        .preset-btn {
            transition: all 0.15s ease;
            border: 2px solid transparent;
        }
        .preset-btn:hover { border-color: #4f46e5; }
        .preset-btn.active { border-color: #4f46e5; background: #2a2a2a; }
        .color-swatch {
            transition: transform 0.15s ease;
            border: 2px solid transparent;
        }
        .color-swatch:hover { transform: scale(1.1); }
        .color-swatch.active { border-color: white; }
        input[type="range"] {
            -webkit-appearance: none;
            background: #2a2a2a;
            border-radius: 4px;
            height: 6px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #4f46e5;
            border-radius: 50%;
            cursor: pointer;
        }
        .tool-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        .tool-btn:hover { background: #3a3a3a; }
        .tool-btn.active { background: #4f46e5; }
        #canvas {
            cursor: crosshair;
            border-radius: 8px;
            image-rendering: pixelated;
        }
        .section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #888;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="min-h-screen overflow-hidden">
    <!-- Header -->
    <header class="px-6 py-4 flex items-center justify-between border-b border-gray-800">
        <div>
            <h1 class="text-xl font-semibold text-white">Turing Patterns Studio</h1>
            <p class="text-sm text-gray-500">Create mesmerizing reaction-diffusion art</p>
        </div>
        <button id="infoBtn" class="btn px-4 py-2 rounded-lg text-sm flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            About
        </button>
    </header>

    <div class="flex h-[calc(100vh-73px)]">
        <!-- Left Toolbar -->
        <div class="w-16 panel m-3 mr-0 p-2 flex flex-col items-center gap-2">
            <div class="section-title text-center">Tools</div>
            <button id="brushTool" class="tool-btn active" title="Brush (B)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                </svg>
            </button>
            <button id="eraseTool" class="tool-btn" title="Eraser (E)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
            </button>
            <div class="w-full h-px bg-gray-700 my-2"></div>
            <div class="section-title text-center">Size</div>
            <button id="sizeS" class="tool-btn text-xs font-bold" title="Small brush">S</button>
            <button id="sizeM" class="tool-btn active text-xs font-bold" title="Medium brush">M</button>
            <button id="sizeL" class="tool-btn text-xs font-bold" title="Large brush">L</button>
        </div>

        <!-- Main Canvas Area -->
        <div class="flex-1 flex items-center justify-center p-6">
            <canvas id="canvas" width="256" height="256" style="width: 512px; height: 512px;"></canvas>
        </div>

        <!-- Right Control Panel -->
        <div class="w-72 panel m-3 ml-0 overflow-y-auto">
            <!-- Presets Section -->
            <div class="panel-section p-4">
                <div class="section-title">Pattern Presets</div>
                <div id="presetGrid" class="grid grid-cols-3 gap-2"></div>
            </div>

            <!-- Color Section -->
            <div class="panel-section p-4">
                <div class="section-title">Color Palette</div>
                <div id="colorPalettes" class="grid grid-cols-4 gap-2"></div>
            </div>

            <!-- Simulation Controls -->
            <div class="p-4">
                <div class="section-title">Simulation</div>
                <div class="mb-3">
                    <label class="text-sm text-gray-400 block mb-1">Speed: <span id="speedVal">1.0</span>x</label>
                    <input type="range" id="speed" min="1" max="20" step="1" value="8" class="w-full">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="playPauseBtn" class="btn py-2 rounded-lg text-sm flex items-center justify-center gap-2">
                        <span id="playPauseText">Pause</span>
                    </button>
                    <button id="resetBtn" class="btn py-2 rounded-lg text-sm">Reset</button>
                    <button id="randomizeBtn" class="btn py-2 rounded-lg text-sm">Randomize</button>
                    <button id="clearBtn" class="btn py-2 rounded-lg text-sm">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
        <div class="panel p-6 max-w-lg">
            <h3 class="text-lg font-semibold mb-4">About Turing Patterns</h3>
            <p class="text-gray-300 mb-3">
                Turing patterns are mathematical models describing how patterns emerge in nature through chemical reactions and diffusion. First proposed by Alan Turing in 1952.
            </p>
            <p class="text-gray-300 mb-4">
                Click and drag on the canvas to add seeds that grow into organic patterns!
            </p>
            <button id="closeInfo" class="btn w-full py-2 rounded-lg">Close</button>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const PRESETS = {
            spots: { name: 'Spots', f: 0.055, k: 0.062 },
            stripes: { name: 'Stripes', f: 0.035, k: 0.060 },
            spirals: { name: 'Spirals', f: 0.014, k: 0.054 },
            coral: { name: 'Coral', f: 0.0545, k: 0.062 },
            worms: { name: 'Worms', f: 0.058, k: 0.065 },
            waves: { name: 'Waves', f: 0.018, k: 0.051 },
            honeycomb: { name: 'Honeycomb', f: 0.034, k: 0.056 },
            fingerprint: { name: 'Fingerprint', f: 0.029, k: 0.057 },
            maze: { name: 'Maze', f: 0.029, k: 0.057 },
            mitosis: { name: 'Mitosis', f: 0.0367, k: 0.0649 },
            solitons: { name: 'Solitons', f: 0.03, k: 0.062 },
            bubbles: { name: 'Bubbles', f: 0.025, k: 0.060 }
        };

        const PALETTES = {
            ocean: { name: 'Ocean', colors: [[10,22,40], [30,77,107], [58,169,171], [168,230,207], [255,255,255]] },
            fire: { name: 'Fire', colors: [[0,0,0], [139,0,0], [255,69,0], [255,165,0], [255,255,0], [255,255,255]] },
            purple: { name: 'Purple', colors: [[26,10,46], [74,14,120], [139,47,201], [216,150,255], [255,240,245]] },
            forest: { name: 'Forest', colors: [[10,47,10], [30,86,49], [60,179,113], [144,238,144], [240,255,240]] },
            sunset: { name: 'Sunset', colors: [[12,20,69], [74,28,110], [165,49,124], [244,96,54], [249,199,79]] },
            grayscale: { name: 'Gray', colors: [[0,0,0], [128,128,128], [255,255,255]] },
            mint: { name: 'Mint', colors: [[13,59,59], [32,116,107], [62,180,137], [152,216,200], [247,255,247]] },
            monoblue: { name: 'Blue', colors: [[10,25,41], [30,58,95], [61,106,159], [126,184,218], [255,255,255]] }
        };

        // ========== STATE ==========
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        let gridA = new Float32Array(width * height);
        let gridB = new Float32Array(width * height);
        let nextA = new Float32Array(width * height);
        let nextB = new Float32Array(width * height);

        let currentPreset = 'spots';
        let f = PRESETS.spots.f;
        let k = PRESETS.spots.k;
        const dA = 1.0;
        const dB = 0.5;

        let currentPalette = 'ocean';
        let paused = false;
        let tool = 'brush';
        let brushSize = 8;
        let simSpeed = 8;

        // ========== INITIALIZATION ==========
        function initGrid() {
            for (let i = 0; i < width * height; i++) {
                gridA[i] = 1.0;
                gridB[i] = 0.0;
            }
            // Add random seeds
            for (let s = 0; s < 30; s++) {
                const cx = Math.floor(Math.random() * width);
                const cy = Math.floor(Math.random() * height);
                const r = 2 + Math.floor(Math.random() * 5);
                addSeed(cx, cy, r);
            }
            // Add center seed
            addSeed(width/2, height/2, 10);
        }

        function addSeed(cx, cy, radius) {
            for (let dy = -radius; dy <= radius; dy++) {
                for (let dx = -radius; dx <= radius; dx++) {
                    if (dx*dx + dy*dy <= radius*radius) {
                        const x = (cx + dx + width) % width;
                        const y = (cy + dy + height) % height;
                        const idx = y * width + x;
                        gridA[idx] = 0.5;
                        gridB[idx] = 0.25;
                    }
                }
            }
        }

        function clearGrid() {
            for (let i = 0; i < width * height; i++) {
                gridA[i] = 1.0;
                gridB[i] = 0.0;
            }
        }

        // ========== SIMULATION ==========
        function simulate() {
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = y * width + x;

                    // Get neighbors with wrapping
                    const left = y * width + ((x - 1 + width) % width);
                    const right = y * width + ((x + 1) % width);
                    const up = ((y - 1 + height) % height) * width + x;
                    const down = ((y + 1) % height) * width + x;

                    // Laplacian
                    const laplaceA = gridA[left] + gridA[right] + gridA[up] + gridA[down] - 4 * gridA[idx];
                    const laplaceB = gridB[left] + gridB[right] + gridB[up] + gridB[down] - 4 * gridB[idx];

                    // Gray-Scott equations
                    const a = gridA[idx];
                    const b = gridB[idx];
                    const abb = a * b * b;

                    nextA[idx] = a + (dA * laplaceA - abb + f * (1 - a));
                    nextB[idx] = b + (dB * laplaceB + abb - (k + f) * b);

                    // Clamp values
                    nextA[idx] = Math.max(0, Math.min(1, nextA[idx]));
                    nextB[idx] = Math.max(0, Math.min(1, nextB[idx]));
                }
            }

            // Swap buffers
            [gridA, nextA] = [nextA, gridA];
            [gridB, nextB] = [nextB, gridB];
        }

        // ========== RENDERING ==========
        function getColor(value, palette) {
            const colors = PALETTES[palette].colors;
            const t = Math.max(0, Math.min(1, value));
            const scaledT = t * (colors.length - 1);
            const i = Math.floor(scaledT);
            const frac = scaledT - i;

            if (i >= colors.length - 1) return colors[colors.length - 1];

            const c1 = colors[i];
            const c2 = colors[i + 1];

            return [
                Math.round(c1[0] + (c2[0] - c1[0]) * frac),
                Math.round(c1[1] + (c2[1] - c1[1]) * frac),
                Math.round(c1[2] + (c2[2] - c1[2]) * frac)
            ];
        }

        function render() {
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            for (let i = 0; i < width * height; i++) {
                const color = getColor(gridB[i], currentPalette);
                const idx = i * 4;
                data[idx] = color[0];
                data[idx + 1] = color[1];
                data[idx + 2] = color[2];
                data[idx + 3] = 255;
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // ========== INTERACTION ==========
        function applyBrush(x, y) {
            // Scale from display size to actual canvas size
            const rect = canvas.getBoundingClientRect();
            const scaleX = width / rect.width;
            const scaleY = height / rect.height;
            const cx = Math.floor(x * scaleX);
            const cy = Math.floor(y * scaleY);

            const r = Math.floor(brushSize * scaleX);

            for (let dy = -r; dy <= r; dy++) {
                for (let dx = -r; dx <= r; dx++) {
                    if (dx*dx + dy*dy <= r*r) {
                        const px = (cx + dx + width) % width;
                        const py = (cy + dy + height) % height;
                        const idx = py * width + px;

                        if (tool === 'eraser') {
                            gridA[idx] = 1.0;
                            gridB[idx] = 0.0;
                        } else {
                            gridA[idx] = 0.5;
                            gridB[idx] = 0.25;
                        }
                    }
                }
            }
        }

        // ========== ANIMATION LOOP ==========
        function animate() {
            if (!paused) {
                for (let i = 0; i < simSpeed; i++) {
                    simulate();
                }
            }
            render();
            requestAnimationFrame(animate);
        }

        // ========== UI SETUP ==========
        // Preset buttons
        const presetGrid = document.getElementById('presetGrid');
        Object.entries(PRESETS).forEach(([key, preset]) => {
            const btn = document.createElement('button');
            btn.className = 'preset-btn p-2 rounded-lg text-center text-xs';
            btn.textContent = preset.name;
            if (key === currentPreset) btn.classList.add('active');
            btn.addEventListener('click', () => {
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPreset = key;
                f = PRESETS[key].f;
                k = PRESETS[key].k;
            });
            presetGrid.appendChild(btn);
        });

        // Color palette buttons
        const colorPalettes = document.getElementById('colorPalettes');
        Object.entries(PALETTES).forEach(([key, palette]) => {
            const swatch = document.createElement('button');
            swatch.className = 'color-swatch w-10 h-10 rounded-lg';
            const colors = palette.colors;
            const gradientStops = colors.map((c, i) => `rgb(${c[0]},${c[1]},${c[2]}) ${i * 100 / (colors.length-1)}%`).join(', ');
            swatch.style.background = `linear-gradient(135deg, ${gradientStops})`;
            swatch.title = palette.name;
            if (key === currentPalette) swatch.classList.add('active');
            swatch.addEventListener('click', () => {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                swatch.classList.add('active');
                currentPalette = key;
            });
            colorPalettes.appendChild(swatch);
        });

        // Tool buttons
        document.getElementById('brushTool').addEventListener('click', () => {
            tool = 'brush';
            document.getElementById('brushTool').classList.add('active');
            document.getElementById('eraseTool').classList.remove('active');
        });
        document.getElementById('eraseTool').addEventListener('click', () => {
            tool = 'eraser';
            document.getElementById('eraseTool').classList.add('active');
            document.getElementById('brushTool').classList.remove('active');
        });

        // Brush size
        const sizes = { S: 4, M: 8, L: 16 };
        ['S', 'M', 'L'].forEach(size => {
            document.getElementById('size' + size).addEventListener('click', () => {
                brushSize = sizes[size];
                ['S', 'M', 'L'].forEach(s => document.getElementById('size' + s).classList.remove('active'));
                document.getElementById('size' + size).classList.add('active');
            });
        });

        // Speed slider
        document.getElementById('speed').addEventListener('input', (e) => {
            simSpeed = parseInt(e.target.value);
            document.getElementById('speedVal').textContent = (simSpeed / 8).toFixed(1);
        });

        // Control buttons
        document.getElementById('playPauseBtn').addEventListener('click', () => {
            paused = !paused;
            document.getElementById('playPauseText').textContent = paused ? 'Play' : 'Pause';
        });
        document.getElementById('resetBtn').addEventListener('click', initGrid);
        document.getElementById('randomizeBtn').addEventListener('click', initGrid);
        document.getElementById('clearBtn').addEventListener('click', clearGrid);

        // Canvas interaction
        let isDrawing = false;

        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            applyBrush(e.clientX - rect.left, e.clientY - rect.top);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                const rect = canvas.getBoundingClientRect();
                applyBrush(e.clientX - rect.left, e.clientY - rect.top);
            }
        });

        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseleave', () => isDrawing = false);

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            applyBrush(touch.clientX - rect.left, touch.clientY - rect.top);
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (isDrawing) {
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                applyBrush(touch.clientX - rect.left, touch.clientY - rect.top);
            }
        }, { passive: false });

        canvas.addEventListener('touchend', () => isDrawing = false);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'b') document.getElementById('brushTool').click();
            if (e.key === 'e') document.getElementById('eraseTool').click();
            if (e.key === ' ') { e.preventDefault(); document.getElementById('playPauseBtn').click(); }
            if (e.key === 'r') document.getElementById('resetBtn').click();
        });

        // Modals
        document.getElementById('infoBtn').addEventListener('click', () => {
            document.getElementById('infoModal').classList.remove('hidden');
            document.getElementById('infoModal').classList.add('flex');
        });
        document.getElementById('closeInfo').addEventListener('click', () => {
            document.getElementById('infoModal').classList.add('hidden');
            document.getElementById('infoModal').classList.remove('flex');
        });

        // Start!
        initGrid();
        animate();
        console.log('Turing Patterns Studio initialized!');
    </script>
</body>
</html>
